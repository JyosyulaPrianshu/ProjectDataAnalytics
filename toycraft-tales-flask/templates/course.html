{% extends 'base.html' %}
{% block title %}Learning Courses | ToyCraft Tales{% endblock %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  body.course-bg {
    background: linear-gradient(135deg, #e0e7ff 0%, #f8fafc 100%);
    min-height: 100vh;
    font-family: 'Inter', sans-serif;
  }
  .hero-section {
    background: linear-gradient(120deg, #60a5fa 0%, #a78bfa 100%);
    border-radius: 32px;
    box-shadow: 0 8px 32px 0 rgba(80, 80, 180, 0.13);
    padding: 3.5rem 2rem 2.5rem 2rem;
    margin: 2.5rem auto 3rem auto;
    max-width: 900px;
    text-align: center;
    color: #fff;
    position: relative;
    overflow: hidden;
    font-family: 'Inter', sans-serif;
    animation: fadeInUp 1.2s cubic-bezier(.4,2,.6,1);
  }
  .hero-section h1 {
    font-weight: 800;
    font-size: 2.7rem;
    margin-bottom: 0.5rem;
    letter-spacing: -1.5px;
    color: #fff;
    text-shadow: 0 2px 16px rgba(80,80,180,0.13);
  }
  .hero-section p {
    color: #e0e7ff;
    font-size: 1.25rem;
    margin-bottom: 0;
    font-weight: 400;
    text-shadow: 0 1px 8px rgba(80,80,180,0.10);
  }
  .rewards-banner {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    border-radius: 16px;
    padding: 1.5rem;
    margin: 1rem auto;
    max-width: 900px;
    text-align: center;
    color: #fff;
    box-shadow: 0 4px 20px rgba(251, 191, 36, 0.3);
  }
  .rewards-banner h3 {
    font-weight: 700;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }
  .rewards-banner p {
    font-size: 1.1rem;
    margin-bottom: 0;
    opacity: 0.9;
  }
  .course-section {
    margin: 0 auto 2.5rem auto;
    max-width: 1100px;
    padding: 0 1rem;
  }
  .course-title {
    font-size: 2.1rem;
    font-weight: 800;
    color: #22223b;
    margin-bottom: 1.5rem;
    letter-spacing: -1px;
    text-align: left;
    padding-left: 0.2rem;
  }
  .resource-category {
    font-size: 1.15rem;
    font-weight: 700;
    color: #6366f1;
    margin-bottom: 0.7rem;
    margin-top: 2.2rem;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .resource-list {
    display: flex;
    flex-wrap: wrap;
    gap: 2.2rem;
    margin-bottom: 2.5rem;
    justify-content: flex-start;
  }
  .resource-card {
    background: rgba(255,255,255,0.85);
    border-radius: 22px;
    box-shadow: 0 6px 32px 0 rgba(80, 80, 180, 0.10);
    padding: 2.1rem 1.5rem 1.5rem 1.5rem;
    width: 100%;
    max-width: 340px;
    min-width: 260px;
    transition: transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s;
    position: relative;
    overflow: hidden;
    font-family: 'Inter', sans-serif;
    border: 1.5px solid #e0e7ff;
    animation: fadeInUp 1.1s cubic-bezier(.4,2,.6,1);
  }
  .resource-card:hover {
    transform: translateY(-8px) scale(1.035);
    box-shadow: 0 12px 40px 0 rgba(80, 80, 180, 0.18);
    border: 1.5px solid #a5b4fc;
  }
  .resource-title {
    font-size: 1.18rem;
    font-weight: 700;
    color: #22223b;
    margin-bottom: 0.5rem;
    letter-spacing: -0.5px;
  }
  .resource-desc {
    color: #6b7280;
    font-size: 1.01rem;
    margin-bottom: 1.2rem;
    min-height: 56px;
    transition: color 0.2s;
  }
  .resource-btn {
    display: inline-block;
    background: linear-gradient(90deg, #6366f1 0%, #60a5fa 100%);
    color: #fff;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    padding: 0.7rem 1.4rem;
    font-size: 1.05rem;
    text-decoration: none;
    margin-top: 0.2rem;
    margin-right: 0.5rem;
    transition: background 0.18s, box-shadow 0.18s;
    box-shadow: 0 2px 8px 0 rgba(99,102,241,0.10);
  }
  .resource-btn:hover {
    background: linear-gradient(90deg, #4338ca 0%, #3b82f6 100%);
    color: #fff;
    box-shadow: 0 4px 16px 0 rgba(99,102,241,0.16);
  }
  .quiz-btn {
    display: inline-block;
    background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);
    color: #fff;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    padding: 0.7rem 1.4rem;
    font-size: 1.05rem;
    text-decoration: none;
    margin-top: 0.2rem;
    transition: background 0.18s, box-shadow 0.18s;
    box-shadow: 0 2px 8px 0 rgba(245, 158, 11, 0.10);
  }
  .quiz-btn:hover:not(.disabled) {
    background: linear-gradient(90deg, #d97706 0%, #f59e0b 100%);
    color: #fff;
    box-shadow: 0 4px 16px 0 rgba(245, 158, 11, 0.16);
  }
  .quiz-btn.disabled {
    background: #22c55e;
    opacity: 0.8;
    cursor: not-allowed;
    pointer-events: none;
  }
  .progress-bar-container {
    height: 20px;
    background-color: #e0e7ff;
    border-radius: 10px;
    overflow: hidden;
  }
  .progress-bar {
    height: 100%;
    background-color: #6366f1;
    transition: width 0.3s ease-in-out;
  }
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<div class="hero-section">
  <h1>Hi {{ (user.name if user and user.name else (user.email.split('@')[0] if user and user.email else 'there')) }}!</h1>
  <p>Welcome to your personalized learning journey. Here you'll find the best, most recognized Data Analytics and Tableau coursesâ€”carefully curated for you. Start learning, earn certificates, and level up your career with a beautiful experience!</p>
</div>

{% if total_points > 0 %}
<div class="rewards-banner">
  <h3>ðŸŽ‰ Your Learning Rewards</h3>
  <p>You've earned <strong>{{ total_points }} points</strong> so far! Keep learning to unlock more rewards and certificates.</p>
  <a href="{{ url_for('rewards') }}" class="resource-btn" style="margin-top: 1rem;">View My Rewards</a>
</div>
{% endif %}

<div class="course-section">
  <div class="course-title">Data Analytics</div>
  <div class="resource-category">Learning Resources</div>
  <div style="max-width:340px;margin-bottom:1.2rem;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <span style="font-weight:600;color:#6366f1;">Progress</span>
      <span style="font-size:1rem;font-weight:600;color:#22223b;" id="analytics-progress-text">{{ analytics_progress }}%</span>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="analytics-progress-bar" style="width: {{ analytics_progress }}%;"></div>
    </div>
  </div>
  <div class="resource-list">
    <div class="resource-card">
      <div class="resource-title">GeeksforGeeks: Data Science & Analytics</div>
      <div class="resource-desc">Hundreds of free, well-structured tutorials on Data Analytics, Python, Pandas, and more. No login required.</div>
      <a class="resource-btn" href="https://www.geeksforgeeks.org/data-science-tutorial/" target="_blank" data-course-id="data_analytics" data-resource-id="gfg">Open & Learn</a>
      <a class="quiz-btn {% if analytics_quiz_status.get('gfg') %}disabled{% endif %}" 
         href="{% if not analytics_quiz_status.get('gfg') %}{{ url_for('take_quiz', course_id='data_analytics', resource_id='gfg') }}{% else %}#{% endif %}">
        {% if analytics_quiz_status.get('gfg') %}âœ” Quiz Completed{% else %}Take Quiz{% endif %}
      </a>
    </div>
    <div class="resource-card">
      <div class="resource-title">Kaggle Learn: Data Science Micro-courses</div>
      <div class="resource-desc">Free, interactive micro-courses on Python, Pandas, Data Visualization, and more. No login required to read lessons.</div>
      <a class="resource-btn" href="https://www.kaggle.com/learn/overview" target="_blank" data-course-id="data_analytics" data-resource-id="kaggle">Open & Learn</a>
      <a class="quiz-btn {% if analytics_quiz_status.get('kaggle') %}disabled{% endif %}" 
         href="{% if not analytics_quiz_status.get('kaggle') %}{{ url_for('take_quiz', course_id='data_analytics', resource_id='kaggle') }}{% else %}#{% endif %}">
        {% if analytics_quiz_status.get('kaggle') %}âœ” Quiz Completed{% else %}Take Quiz{% endif %}
      </a>
    </div>
  </div>
</div>

<div class="course-section">
  <div class="course-title">Data Analytics with Tableau / Data Visualization</div>
  <div class="resource-category">Learning Resources</div>
  <div style="max-width:340px;margin-bottom:1.2rem;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <span style="font-weight:600;color:#6366f1;">Progress</span>
      <span style="font-size:1rem;font-weight:600;color:#22223b;" id="tableau-progress-text">{{ tableau_progress }}%</span>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="tableau-progress-bar" style="width: {{ tableau_progress }}%;"></div>
    </div>
  </div>
  <div class="resource-list">
    <div class="resource-card">
      <div class="resource-title">Tableau Official Free Training Videos</div>
      <div class="resource-desc">Official Tableau video tutorials. No certificate, but always free and up-to-date.</div>
      <a class="resource-btn" href="https://www.tableau.com/learn/training/20211" target="_blank" data-course-id="tableau" data-resource-id="tableau">Open & Learn</a>
      <a class="quiz-btn {% if tableau_quiz_status.get('tableau') %}disabled{% endif %}" 
         href="{% if not tableau_quiz_status.get('tableau') %}{{ url_for('take_quiz', course_id='tableau', resource_id='tableau') }}{% else %}#{% endif %}">
        {% if tableau_quiz_status.get('tableau') %}âœ” Quiz Completed{% else %}Take Quiz{% endif %}
      </a>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.body.classList.add('course-bg');

  // Course resource definitions (should match backend)
  const courseResources = {
    'data_analytics': ['gfg', 'kaggle'],
    'tableau': ['tableau']
  };

  // Track opened resources (initialize with server data)
  let openedResources = {
    'data_analytics': new Set(),
    'tableau': new Set()
  };

  // Initialize progress based on server data
  const initialAnalyticsProgress = {{ analytics_progress }};
  const initialTableauProgress = {{ tableau_progress }};
  
  // Calculate initially opened resources based on progress
  const analyticsCount = Math.round((initialAnalyticsProgress / 100) * courseResources.data_analytics.length);
  const tableauCount = Math.round((initialTableauProgress / 100) * courseResources.tableau.length);
  
  for (let i = 0; i < analyticsCount; i++) {
    openedResources.data_analytics.add(courseResources.data_analytics[i]);
  }
  for (let i = 0; i < tableauCount; i++) {
    openedResources.tableau.add(courseResources.tableau[i]);
  }

  function updateProgress(courseId) {
    const opened = openedResources[courseId].size;
    const total = courseResources[courseId].length;
    const percentage = Math.round((opened / total) * 100);
    
    if (courseId === 'data_analytics') {
      document.getElementById('analytics-progress-bar').style.width = percentage + '%';
      document.getElementById('analytics-progress-text').textContent = percentage + '%';
    } else if (courseId === 'tableau') {
      document.getElementById('tableau-progress-bar').style.width = percentage + '%';
      document.getElementById('tableau-progress-text').textContent = percentage + '%';
    }
  }

  // Handle resource button clicks
  document.querySelectorAll('.resource-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      const courseId = btn.getAttribute('data-course-id');
      const resourceId = btn.getAttribute('data-resource-id');
      
      if (courseId && resourceId) {
        // Update local state immediately
        openedResources[courseId].add(resourceId);
        updateProgress(courseId);
        
        // Send to server
        fetch('/api/mark-resource-opened', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({course_id: courseId, resource_id: resourceId})
        }).then(response => response.json())
        .then(data => {
          if (!data.success) {
            console.error('Failed to mark resource as opened');
            // Revert local change
            openedResources[courseId].delete(resourceId);
            updateProgress(courseId);
          }
        }).catch(error => {
          console.error('Error marking resource as opened:', error);
          // Revert local change
          openedResources[courseId].delete(resourceId);
          updateProgress(courseId);
        });
      }
    });
  });
});
</script>
{% endblock %}
